1. Agent may only touch code in the current stage.
2. Agent must add/adjust tests for the stage.
3. Agent must demonstrate: go test ./... green.
4. Agent must output the commands for user testing, query the user to perform any necessary user testing in the particular stage the agent is working on.
5. Once user confirms testing, the next stage is unlocked.

STAGES BELOW

Stage 1: Scaffold and tooling
Set up templ and HTMX in the project. Install templ CLI, add HTMX via CDN in a base layout, create a minimal templ component that renders "hello world" on a test route. Verify templ generate works and the binary still compiles/runs. Don't touch existing templates yet.

Stage 2: Base layout and navigation
Create a base layout component in templ that includes: HTML head with HTMX CDN, consistent header/nav area, main content slot, and basic CSS (either inline or embedded file - Pico CSS via CDN is fine for quick wins). Migrate the project list page (/projects) to use this new layout. Keep the old templates intact for other routes during transition.

Stage 3: Project dashboard (/projects/{id})
Rebuild the project dashboard view in templ. The Hosts card should be a clickable element (link or HTMX-powered) that navigates to the hosts list. Move "Back to projects" to the header/breadcrumb area. The Workflow section stays as a stats display. Remove the bottom navigation links that are now redundant.

Stage 4: Hosts list (/projects/{id}/hosts)
Rebuild the hosts inventory page. Filters (subnet/CIDR, status, scope, sort) should use HTMX to reload just the table without full page refresh. Bulk actions and "update port across project" sections remain as forms. The host table with pagination should support HTMX partial updates.

Stage 5: Host detail (/projects/{id}/hosts/{id})
This is your messiest page. Rebuild with clear sections: host notes (form with HTMX submit), ports table with state/service/work status/notes columns. Each port row should allow inline status updates via HTMX. Script output should be in collapsible details elements. Focus on clean vertical layout rather than cramming horizontally.

Stage 6: Cleanup
Remove old template strings from templates.go (or the whole file if fully migrated). Ensure all routes use templ components. Verify cross-compilation still works. Test the full workflow end-to-end.
